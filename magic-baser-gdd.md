# MAGIC BASER — Game Design Document / Промт для доработки

## Стек
- **Next.js 16 + React** (фронтенд)
- **Canvas 2D API** (кастомный игровой движок, без Phaser)
- **Solana + MagicBlock BOLT ECS** (блокчейн)
- **Платформа:** Desktop only

---

## 1. ПЕРСОНАЖИ (ВОЛШЕБНИКИ)

Все персонажи — пиксельные спрайты 32×32. Визуально различаются цветом мантии, формой шляпы/капюшона и эффектами. У каждого уникальная пассивная способность, которая влияет на стиль игры.

### Tier: FREE (стартовый)

| # | Имя | HP | SPD | DMG | Мантия/цвет | Пассивная способность | Описание |
|---|-----|-----|------|------|-------------|----------------------|----------|
| 1 | **Игнис** | 80 | 1.0x | 1.3x | Красная мантия, остроконечная шляпа с пламенем | **Огненный след** — оставляет за собой горящую дорожку (длится 3 сек), мобы получают 5 урона/сек проходя по ней | Fire Mage. Агрессивный стиль — бегай через толпу |

### Tier I (разблокировка: 100 gold)

| # | Имя | HP | SPD | DMG | Мантия/цвет | Пассивная способность | Описание |
|---|-----|-----|------|------|-------------|----------------------|----------|
| 2 | **Глейша** | 120 | 0.8x | 0.9x | Голубая мантия, ледяная корона | **Морозная аура** — замедляет всех мобов в радиусе 80px на 20% | Ice Mage. Танк, медленная но живучая |
| 3 | **Виталис** | 100 | 1.0x | 1.0x | Зелёная мантия с листьями, деревянный посох | **Регенерация** — восстанавливает 1 HP каждые 2 секунды | Nature Mage. Сбалансированный, прощает ошибки |

### Tier II (разблокировка: 250 gold + 200 kills)

| # | Имя | HP | SPD | DMG | Мантия/цвет | Пассивная способность | Описание |
|---|-----|-----|------|------|-------------|----------------------|----------|
| 4 | **Умбра** | 70 | 1.4x | 1.1x | Чёрная мантия с тенями, капюшон скрывает лицо | **Теневой шаг** — каждые 15 сек становится невидимым на 2 сек (мобы теряют цель, проходят сквозь) | Shadow Mage. Быстрый, стеклянная пушка |
| 5 | **Архон** | 90 | 1.0x | 1.0x | Фиолетовая мантия с рунами, парящая книга рядом | **Двойной арсенал** — стартует с 2 оружиями вместо 1 | Arcane Mage. Ранний power spike |

### Tier III (разблокировка: 500 gold + 500 kills)

| # | Имя | HP | SPD | DMG | Мантия/цвет | Пассивная способность | Описание |
|---|-----|-----|------|------|-------------|----------------------|----------|
| 6 | **Нектра** | 60 | 0.9x | 0.8x | Тёмно-зелёная мантия с черепами, костяной посох | **Некромант** — убитые мобы с шансом 10% поднимаются как союзники на 8 сек (идут к ближайшему мобу и наносят урон) | Death Mage. Рискованный, но масштабируется с количеством мобов |
| 7 | **Люмен** | 100 | 1.1x | 1.0x | Белая/золотая мантия, светящийся нимб | **Притяжение света** — радиус подбора XP-гемов и золота увеличен в 2.5 раза | Light Mage. Быстрый левелинг, хорош для фарма |

### Tier: LEGEND (разблокировка: 1000 gold + 1000 kills)

| # | Имя | HP | SPD | DMG | Мантия/цвет | Пассивная способность | Описание |
|---|-----|-----|------|------|-------------|----------------------|----------|
| 8 | **Руника** | 90 | 1.0x | 1.2x | Тёмно-синяя мантия, покрытая мерцающими рунами, посох с кристаллом | **Руническая серия** — каждый 10-й удар любого оружия наносит 3x урона (визуально — вспышка рун вокруг моба) | Rune Mage. Награда за долгую игру |

### Визуальные различия спрайтов (важно для художки):
- Каждый волшебник имеет **уникальный силуэт** — разная форма шляпы/капюшона/короны
- Idle-анимация: 2-4 кадра (плавное покачивание мантии)
- Walk-анимация: 4 кадра (в 4 направлениях или 2 — лево/право с flip)
- Цветовая палитра каждого персонажа уникальна и контрастна на тёмном фоне подземелья

---

## 2. ВРАГИ (МОБЫ)

Все мобы — пиксельные спрайты. Размеры варьируются от 16×16 до 48×48 (боссы). Цветовая палитра мобов — красная/тёмная/зелёная, чтобы контрастировать с синими/светлыми тонами волшебников.

### Обычные мобы

| # | Моб | Размер | HP | SPD | DMG | Поведение | Визуал | Дроп |
|---|-----|--------|-----|------|------|-----------|--------|------|
| 1 | **Скелет** | 24×24 | 15 | 0.7x | 5 | Идёт прямо к игроку. Самый базовый враг. | Белые кости, красные глаза, шатающаяся походка | 1 XP-гем, 5% шанс 1 gold |
| 2 | **Зомби** | 24×24 | 30 | 0.5x | 8 | Идёт к игроку. При смерти оставляет лужу яда (радиус 20px, 3 урона/сек, 3 сек) | Зелёная кожа, рваная одежда, медленная анимация | 2 XP-гема, 10% шанс 1 gold |
| 3 | **Летучая мышь** | 16×16 | 8 | 1.8x | 3 | Летит к игроку зигзагом (синусоида). Сложно попасть. | Маленькая, фиолетовая, быстро машет крыльями | 1 XP-гем, 5% шанс 1 gold |
| 4 | **Привидение** | 24×24 | 20 | 1.0x | 6 | Летит к игроку, проходит сквозь декорации (игнорирует коллизии). Каждые 4 сек становится полупрозрачным и неуязвимым на 1 сек | Полупрозрачный белый силуэт с пустыми глазами | 2 XP-гема, 10% шанс 2 gold |
| 5 | **Рой пауков** | 12×12 (×6) | 5 каждый | 1.2x | 2 каждый | Спавнятся группой 6 штук, разбегаются к игроку. Опасны массой | Маленькие, тёмно-коричневые, 4 ноги видны | 1 XP-гем за каждого, 3% шанс gold |
| 6 | **Тёмный маг** | 28×28 | 40 | 0.6x | 10 (снаряд) | Держится на расстоянии 150-200px от игрока. Стреляет тёмными снарядами каждые 2.5 сек. Убегает если игрок приближается | Тёмный балахон, красные/зелёные глаза, НЕ похож на игрока (рваная мантия, нет шляпы, костлявые руки) | 3 XP-гема, 20% шанс 3 gold |

### Мини-боссы (спавнятся каждую 5-ю волну)

| # | Моб | Размер | HP | SPD | DMG | Поведение | Визуал | Дроп |
|---|-----|--------|-----|------|------|-----------|--------|------|
| 7 | **Каменный голем** | 48×48 | 200 (+50/волна) | 0.4x | 20 (контакт) + 10 AOE | Идёт к игроку. При ударе об землю — AOE землетрясение (радиус 60px, 10 урон). Замах 1 сек (можно увернуться) | Серый каменный гигант, светящиеся жёлтые глаза, трещины на теле | 5 XP-гемов, гарантированно 5-10 gold, 15% шанс сундук (бонус на выбор) |
| 8 | **Некроморф** | 40×40 | 150 (+40/волна) | 0.8x | 12 | Призывает 3 скелетов каждые 8 сек. Сам атакует в ближнем бою | Парящий призрак в балахоне с посохом, зелёное свечение | 5 XP-гемов, гарантированно 5-8 gold |

### Масштабирование мобов по волнам:
- HP мобов растёт на +10% каждую волну
- SPD мобов растёт на +2% каждую волну (капнуто на +30% макс)
- Новые типы мобов разблокируются:
  - Волна 1-3: Скелеты
  - Волна 2-4: + Зомби
  - Волна 3-5: + Летучие мыши
  - Волна 4-7: + Привидения
  - Волна 5+: + Пауки (каждая 5-я волна — мини-босс)
  - Волна 8+: + Тёмные маги

---

## 3. СИСТЕМА ВОЛН (переработка)

**Текущая проблема:** волны приходят каждые 30 секунд по таймеру → игрок может просто стоять и ждать.

**Новая система — волны привязаны к убийствам:**

```
Логика:
- Каждая волна имеет фиксированное количество мобов
- Следующая волна начинается когда убито ≥ 80% мобов текущей волны
- Между волнами — 3 секунды паузы (надпись "WAVE X" на экране)
- При переходе на новую волну игрок выбирает улучшение (как сейчас с level up)

Формула количества мобов:
  Wave 1:  4 моба
  Wave 2:  6 мобов
  Wave 3:  8 мобов
  Wave N:  4 + (N-1) * 2, но максимум 40 мобов одновременно на экране

  После волны 10: рост замедляется, но мобы становятся сильнее (HP/DMG скейлинг)

Спавн мобов внутри волны:
  - Мобы не спавнятся все сразу
  - Спавнятся группами по 2-4 каждые 1-2 секунды
  - Спавнятся за пределами видимой области экрана (на расстоянии ~50px от края viewport)
```

### Улучшения при переходе волны (выбор 1 из 3):
- Новое оружие (Knife, Lightning, Holy Water, Fireball, Bone Shield)
- Апгрейд оружия (+уровень к имеющемуся)
- Пассивный бонус: +10% SPD, +10% DMG, +20 HP, +1 HP/сек реген, +10% радиус подбора, +1 снаряд

---

## 4. ЭКОНОМИКА ЗОЛОТА

### Получение золота:
- Обычный моб: **5% шанс** дропнуть 1 gold (жёлтый гем на полу)
- Усиленный моб (зомби, призрак): **10% шанс** дропнуть 1-2 gold
- Тёмный маг: **20% шанс** дропнуть 2-3 gold
- Мини-босс: **100% шанс** дропнуть 5-10 gold
- Разрушенная бочка: **25% шанс** дропнуть 1 gold

### Ожидаемый заработок за раунд:
- Короткий раунд (5 волн, ~30 мобов): **8-15 gold**
- Средний раунд (10 волн, ~100 мобов): **25-40 gold**
- Длинный раунд (20 волн, ~300 мобов): **60-100 gold**

### Цены разблокировки:
- Tier I персонаж: **100 gold** (≈ 5-8 средних раундов)
- Tier II персонаж: **250 gold + 200 kills** (≈ 10-15 раундов)
- Tier III персонаж: **500 gold + 500 kills** (≈ 20-30 раундов)
- Legend: **1000 gold + 1000 kills** (≈ 40-50 раундов)

Это создаёт ощущение прогрессии: золота достаточно чтобы чувствовать прогресс каждый раунд, но недостаточно чтобы разблокировать всё за час.

---

## 5. КАРТА И МИР (подземелье с вариациями)

### Общая концепция:
Бесконечная карта подземелья, разделённая на **чанки** (chunks). Когда игрок двигается, новые чанки генерируются процедурно за пределами экрана, а далёкие чанки выгружаются из памяти.

### Технические детали (Canvas 2D):

```
Система чанков:
- Размер чанка: 512×512 пикселей (16×16 тайлов по 32px)
- Активная зона: 3×3 чанков вокруг игрока (всего 9 чанков загружено)
- При движении игрока к краю текущего чанка:
  → Генерируем новый ряд/столбец чанков в направлении движения
  → Выгружаем чанки с противоположной стороны (за пределами 3×3)
- Рендерим только то, что попадает в viewport камеры

Оптимизация:
- Предгенерация чанков в offscreen canvas (буферизация)
- Декорации хранятся как массив {x, y, type, destroyed} — не перерисовываются каждый кадр
- Тайлы пола отрисовываются один раз на offscreen canvas чанка
- Только мобы и снаряды перерисовываются каждый кадр на основном canvas
- Culling: не рисуем объекты за пределами viewport + 50px margin
```

### Визуал подземелья:

**Базовый пол (тайлы 32×32):**
- Каменный пол — 3-4 варианта тайлов для разнообразия (с трещинами, мхом, чистый)
- Шахматный или рандомизированный паттерн из тёмных (RGB ~30,30,40) и чуть светлее (RGB ~40,40,55) тайлов

**Вариации подземелья (меняются каждые 5-8 чанков):**

| Зона | Пол | Стены/края | Декорации | Атмосфера |
|------|-----|------------|-----------|-----------|
| **Каменный зал** | Серый камень | Каменные колонны | Бочки, факелы, разбитые горшки | Базовый, стартовый |
| **Склеп** | Тёмный камень с трещинами | Надгробия по краям | Черепа, кости, гробы, паутина | Мрачный |
| **Канализация** | Мокрый камень с лужами | Трубы, решётки | Лужи (визуальные), мох, крысиные кости | Зеленоватый туман |
| **Библиотека** | Деревянный пол | Книжные шкафы | Свитки, упавшие книги, свечи, столы | Тёплое свечение |
| **Тронный зал** | Мрамор | Колонны, знамёна | Троны, ковры, подсвечники | Грандиозный, светлый |

Переход между зонами — **плавный** (несколько тайлов переходные, например камень постепенно становится мокрым).

### Декорации (props):

**С коллизией (блокируют движение игрока И мобов):**

| Объект | Размер | Разрушаемый? | Дроп при разрушении | Визуал |
|--------|--------|-------------|---------------------|--------|
| **Бочка** | 24×24 | Да (15 HP) | 25% → 1 gold, 15% → маленький HP орб | Деревянная, коричневая |
| **Бочка с паутиной** | 24×24 | Да (15 HP) | 20% → 1 gold, 10% → замедление пауков (?) | Бочка + белая паутина поверх |
| **Каменная колонна** | 32×48 | Нет | — | Серая колонна, не разрушается |
| **Гроб (закрытый)** | 24×40 | Да (30 HP) | 40% → 2-3 gold, 15% → спавн 2 скелетов (ловушка!) | Деревянный тёмный гроб |
| **Стол** | 40×24 | Да (20 HP) | 10% → свиток (маленький XP бонус) | Деревянный стол, можно с книгами |

**Без коллизии (визуальные, рисуются на полу):**

| Объект | Визуал |
|--------|--------|
| **Трещины в полу** | 2-3 варианта, тёмные линии на тайле |
| **Лужа (вода/яд)** | Голубая/зелёная, полупрозрачная |
| **Паутина на полу** | Белые нити, маленькая |
| **Мох** | Зелёные пятна по краям тайлов |
| **Следы крови** | Тёмно-красные пятна (для склепа) |
| **Рассыпанные монеты** | Пара жёлтых пикселей (визуал, не подбираются) |
| **Выгоревшее пятно** | Тёмный круг на полу |
| **Мелкие камни** | Серые точки на полу |

### Генерация декораций:
```
При генерации чанка:
- 60% тайлов — пустой пол (разный вариант текстуры)
- 25% тайлов — пол + визуальная декорация (трещина, мох, лужа)
- 10% тайлов — рядом с тайлом может стоять бочка/стол (проверка на проходимость)
- 5% тайлов — колонна или крупный объект

Правила размещения:
- Минимум 2 тайла свободного пространства между объектами с коллизией
- Не блокировать проходы полностью (всегда должен быть путь)
- Декорации не спавнятся в радиусе 3 тайлов от игрока при первом спавне
- Гробы/сундуки — редкие, 1-2 на чанк максимум
```

---

## 6. ШРИФТ

**Текущая проблема:** шрифт плохо читается, особенно мелкий текст.

**Решение:**
- Основной шрифт: **Press Start 2P** (Google Fonts, бесплатный, пиксельный, отлично читается)
- Или альтернатива: **Silkscreen** (ещё более читаемый при мелких размерах)
- Импорт: `@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');`
- Заголовки (LEVEL UP, QUEST COMPLETE): 24-32px
- HUD (HP, EXP, Gold, Kills): 12-14px
- Описания персонажей, мелкий текст: 10-12px
- Отступ между строками (line-height): минимум 1.4x для читаемости
- Цвета текста: белый (#FFFFFF) основной, золотой (#FFD700) для gold/заголовков, красный (#FF4444) для урона/важного, зелёный (#44FF44) для лечения/позитивного

---

## 7. HUD И UI УЛУЧШЕНИЯ

### Игровой HUD (во время боя):

```
┌──────────────────────────────────────────────────────┐
│  [HP BAR ██████████░░░░]  60/110   [LVL 2]         │
│  [XP BAR █████░░░░░░░░░]  110/200                  │
│  GOLD: 45  │  KILLS: 11  │  WAVE: 3  │  TIME: 17s  │
└──────────────────────────────────────────────────────┘
```

- Убрать дублирование (сейчас инфо и в HUD сверху, и в панели слева)
- Панель слева с текстом (Wave, Level, XP, Gold...) → оставить только для паузы
- Оружия показывать иконками в правом верхнем углу (маленькие 16×16 иконки)
- Мини-карта НЕ нужна (подземелье бесконечное, смысла нет)

### Level Up экран:
- Оставить текущий формат (3 карточки на выбор)
- Добавить иконку оружия/бонуса в каждую карточку (сейчас только текст)
- Описание эффекта под названием (например: "Knife — throws a knife every 1.5s, DMG: 10")
- Подсветка при наведении — более яркая рамка

### Quest Complete экран:
- Хороший уже, только шрифт поменять
- Добавить маленькие иконки рядом с числами (череп для kills, часы для time, etc.)

### Экран выбора персонажа:
- Показать спрайт персонажа крупнее (64×64 или 96×96, увеличенный без сглаживания)
- Подсветить уникальную способность отдельным цветом
- Залоченные персонажи — показать условие разблокировки ("100 gold + 200 kills")
- При наведении на залоченного — прогресс-бар до разблокировки

---

## 8. СПРАЙТЫ — ТЕХНИЧЕСКОЕ ЗАДАНИЕ

Все спрайты должны быть выполнены в едином пиксель-арт стиле:
- **Палитра:** ограниченная (16-32 цвета на персонажа), контрастная на тёмном фоне
- **Размеры:** строго кратные 8px (16×16, 24×24, 32×32, 48×48)
- **Контур:** чёрный контур 1px вокруг всех спрайтов
- **Формат:** PNG с прозрачным фоном
- **Анимация:** спрайт-шиты, каждый кадр отдельный тайл в горизонтальной полосе

### Необходимые спрайты:

**Персонажи (32×32 каждый кадр):**
- 8 волшебников × 4 кадра idle × 4 направления = 128 кадров (можно упростить до 2 направлений + flip)
- 8 волшебников × 4 кадра walk × 2 направления = 64 кадра
- Итого минимум: 8 волшебников × (4 idle + 4 walk) = 64 кадра

**Мобы:**
- Скелет (24×24): idle 2 кадра, walk 4 кадра, death 3 кадра
- Зомби (24×24): idle 2 кадра, walk 4 кадра, death 3 кадра + лужа яда (анимация 3 кадра)
- Летучая мышь (16×16): fly 4 кадра, death 2 кадра
- Привидение (24×24): float 4 кадра, fade 2 кадра (неуязвимость), death 3 кадра
- Паук (12×12): crawl 4 кадра, death 2 кадра
- Тёмный маг (28×28): idle 2 кадра, cast 3 кадра, death 3 кадра + снаряд (8×8, 2 кадра)
- Голем (48×48): walk 4 кадра, attack 4 кадра, death 4 кадра
- Некроморф (40×40): float 4 кадра, summon 3 кадра, death 4 кадра

**Тайлы и декорации (32×32 если не указано иначе):**
- Тайлы пола: 4 варианта серый камень, 2 варианта тёмный, 2 варианта мокрый, 2 варианта мрамор, 2 варианта дерево
- Бочка (24×24): целая, разбитая (2 кадра анимации разрушения)
- Бочка с паутиной (24×24): то же + паутина overlay
- Колонна (32×48): 1 вариант
- Гроб (24×40): закрытый, открытый
- Стол (40×24): целый, разбитый
- Трещины (32×32): 3 варианта overlay
- Лужа (32×32): 2 варианта (вода, яд)
- Паутина (32×32): 2 варианта overlay
- Мох (32×32): 2 варианта overlay
- Череп и кости (16×16): 2 варианта
- Факел (16×32): 4 кадра анимации (пламя)
- Свеча (8×16): 2 кадра

**Эффекты:**
- XP-гем (8×8): зелёный, 2 кадра мерцания
- Gold-гем (8×8): жёлтый, 2 кадра мерцания
- HP-орб (10×10): красный, 2 кадра
- Взрыв/смерть (16×16): 4 кадра
- Огненный след (32×8): 3 кадра затухания
- Лужа яда (24×24): 3 кадра затухания
- Ледяная аура (48×48): 2 кадра пульсации (полупрозрачный)

**UI иконки (16×16):**
- Иконки оружий: Magic Wand, Knife, Lightning, Holy Water, Fireball, Bone Shield
- Иконки бонусов: SPD up, DMG up, HP up, Regen, Pickup radius, +Projectile
- Иконки статов: череп (kills), часы (time), звезда (wave), монета (gold)

---

## 9. ПОЛНЫЙ ЧЕКЛИСТ ЗАДАЧ

### Приоритет 1 (критично):
- [ ] Заменить шрифт на Press Start 2P
- [ ] Создать спрайты 8 волшебников (минимум idle + walk)
- [ ] Создать спрайты 8 типов мобов (минимум idle + walk + death)
- [ ] Переделать систему волн: убийства вместо таймера
- [ ] Реализовать chunk-based карту (чанки 512×512, 3×3 активных)
- [ ] Добавить базовые тайлы пола (вариации камня)

### Приоритет 2 (важно):
- [ ] Добавить декорации с коллизиями (бочки, колонны)
- [ ] Реализовать разрушение бочек с дропом
- [ ] Добавить визуальные декорации (трещины, мох, лужи)
- [ ] Реализовать пассивные способности персонажей
- [ ] Добавить новые типы мобов с уникальным поведением (зигзаг у мышей, дистанция у магов)
- [ ] Сбалансировать дроп золота по новой формуле

### Приоритет 3 (полировка):
- [ ] Вариации подземелья (склеп, канализация, библиотека, тронный зал)
- [ ] Плавные переходы между зонами
- [ ] Анимации эффектов (огненный след, ледяная аура, руническая вспышка)
- [ ] Мини-боссы каждые 5 волн
- [ ] Иконки оружий и бонусов в UI
- [ ] Прогресс-бар разблокировки на экране выбора персонажа
- [ ] Спрайт-анимации на экране Quest Complete (факелы, мерцание)

---

*Этот документ — полный промт для доработки Magic Baser. Каждый раздел можно брать как отдельную задачу.*
